"use strict";(self.webpackChunkmy_site=self.webpackChunkmy_site||[]).push([[8401],{1490:(e,t,n)=>{n.d(t,{A:()=>I});var o=n(542),r=n(6540);var s=n(2498),c=n(3161),a=n(6065);function i(e,t){return e.map(e=>{if(!e.text)return e;const n=function(e,t){const{contextBefore:n,text:o,contextAfter:r}=e,s=n?.trim()||"",c=o?.trim()||"",a=r?.trim()||"";if(!c)return null;const i=function(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let o;for(;o=n.nextNode();)o.textContent&&o.textContent.trim().length>0&&t.push(o);return t}(t),d=[{full:`${s} ${c} ${a}`.trim(),match:c},{full:`${s} ${c}`.trim(),match:c},{full:`${c} ${a}`.trim(),match:c},{full:c,match:c}];for(const m of i){if(m.parentElement?.closest("#comment-sidebar"))continue;const e=m.textContent||"";for(const{full:t,match:n}of d){let o=0;for(;;){const r=e.indexOf(t,o);if(-1===r)break;const c=r+t.indexOf(n),i=c+n.length;try{const e=document.createRange();e.setStart(m,c),e.setEnd(m,i);const t=e.getBoundingClientRect();if(l(m,s,a))return t.top+window.scrollY}catch{}o=r+t.length}}}return null}(e,t);return n?{...e,y:n}:e})}function l(e,t,n){const o=e.parentElement?.textContent||"",r=!t||o.includes(t.slice(-10)),s=!n||o.includes(n.slice(0,10));return r&&s}const d={commentLayer:"commentLayer_Vry1",commentSidebar:"commentSidebar_Hu3x",portal:"portal_mP3Z",highlightedText:"highlightedText_nRlz",hovered:"hovered_GV92",highlightedImage:"highlightedImage_l1cf"};const m={wrapper:"wrapper_q4AH",sidebar:"sidebar_s1MZ",commentLayer:"commentLayer_yPvp",toggleButton:"toggleButton_SiYq",toggleHide:"toggleHide_uOqL",toggleShow:"toggleShow_xowA"},u="draftCommentCard_ywwp",h="commentCardInput_xwF1",f="draftActions_sH1F",x="draftCommentCardButton_CvAD";var g=n(4848);const p=({draftComment:e,onCommentChange:t,onSubmit:n})=>(0,g.jsxs)("div",{className:u,style:{top:`${e.top}px`},children:[(0,g.jsx)("p",{children:(0,g.jsxs)("strong",{children:["Draft for \u201c",e.text,"\u201d"]})}),(0,g.jsxs)("form",{children:[(0,g.jsx)("textarea",{placeholder:"Write your comment...",value:e.comment,className:h,onChange:e=>{t(t=>t&&{...t,comment:e.target.value})}}),(0,g.jsxs)("div",{className:f,children:[(0,g.jsx)("button",{type:"submit",className:x,onClick:t=>{e.comment.trim()&&(t.preventDefault(),n(e))},children:"Submit"}),(0,g.jsx)("button",{className:x,onClick:()=>t(null),children:"Cancel"})]})]})]}),w={commentCard:"commentCard_lLa2",header:"header_fQQ6",preview:"preview_YR5A",footer:"footer__n3v",meta:"meta_mA2v",commentCardInput:"commentCardInput_Sl_e",showMoreButton:"showMoreButton_oENQ",resolveButton:"resolveButton_Ebqi"};var C=n(7716),y=n(3092),j=n(2239),v=n(961);const S=({card:e,onResolve:t})=>{const[n,o]=(0,r.useState)(!1),s=e.text.slice(0,50),c=e.comment.slice(0,100),a=e.text.length>50,i=e.comment.length>100;return(0,g.jsxs)(g.Fragment,{children:[(0,g.jsxs)("div",{className:`${w.commentCard} ${i?w.fade:""}`,onMouseEnter:()=>document.querySelector(`[data-comment-id="${e.id}"]`)?.classList.add(d.hovered),onMouseLeave:()=>document.querySelector(`[data-comment-id="${e.id}"]`)?.classList.remove(d.hovered),children:[(0,g.jsx)("div",{className:w.header,children:(0,g.jsxs)("strong",{className:w.quotedText,children:["\u201c",s,a&&"\u2026","\u201d"]})}),(0,g.jsxs)("div",{className:w.preview,children:[c,i&&"\u2026"]}),i&&(0,g.jsx)("button",{className:w.showMoreButton,onClick:e=>{e.stopPropagation(),o(!0)},children:"Show more \u2192"}),(0,g.jsxs)("div",{className:w.footer,children:[(0,g.jsxs)("div",{className:w.meta,children:[(0,g.jsxs)("span",{className:w.author,children:["- ",e.user]}),(0,g.jsx)("span",{className:w.time,children:$(e.createdAt)})]}),(0,g.jsx)("button",{className:w.resolveButton,onClick:n=>{n.stopPropagation(),t(e)},children:"Resolve"})]})]}),(0,g.jsx)(b,{open:n,onClose:()=>o(!1),card:e})]})},b=({open:e,onClose:t,card:n})=>{const o=(0,r.useRef)(null);if(!e)return null;return(0,v.createPortal)((0,g.jsx)("div",{ref:o,onClick:e=>{e.target===o.current&&t()},style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",padding:"40px",zIndex:9999,display:"flex",justifyContent:"center",overflowY:"auto"},children:(0,g.jsxs)("div",{style:{background:"white",padding:"48px",marginTop:"15%",marginBottom:"15%",borderRadius:"10px",maxWidth:"700px",width:"100%",boxShadow:"0 4px 30px rgba(0,0,0,0.2)"},children:[(0,g.jsx)("h3",{children:n.text}),(0,g.jsx)(C.oz,{remarkPlugins:[y.A],rehypePlugins:[j.A],children:n.comment}),(0,g.jsx)("p",{children:(0,g.jsxs)("em",{children:["- ",n.user]})}),(0,g.jsx)("button",{onClick:t,style:{marginTop:"20px"},children:"Close"})]})}),document.getElementById("modal-root"))};function $(e){const t=new Date(e),n=(Date.now()-t.getTime())/1e3;return n<60?`${Math.floor(n)}s ago`:n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:n<604800?`${Math.floor(n/86400)}d ago`:n<2629800?`${Math.floor(n/604800)}w ago`:n<31557600?`${Math.floor(n/2629800)}mo ago`:`${Math.floor(n/31557600)}y ago`}const _=20;function N({canSeeComments:e,showSidebar:t,draftComment:n,comments:o,setShowSidebar:s,setDraftComment:c,handleAddComment:a,onResolveComment:i}){const l=(0,r.useRef)({}),[d,u]=(0,r.useState)({}),[h,f]=(0,r.useState)(null);return(0,r.useLayoutEffect)(()=>{requestAnimationFrame(()=>{const e=o.map(e=>({id:e.id,height:l.current[e.id]?.offsetHeight??350})),t=[...o].sort((e,t)=>e.y-t.y);let n=0;const r={};for(const o of t){const t=e.find(e=>e.id===o.id)?.height??150,s=o.y-270,c=Math.max(s,n);r[o.id]=c,n=c+t+_}u(r)})},[o]),(0,g.jsx)(g.Fragment,{children:e&&(0,g.jsx)("div",{className:m.wrapper,children:t?(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("button",{onClick:()=>s(!1),className:`${m.toggleButton} ${m.toggleHide}`,children:"\u276f"}),(0,g.jsx)("div",{className:m.sidebar,id:"comment-sidebar",children:(0,g.jsxs)("div",{className:m.commentLayer,children:[n&&(0,g.jsx)(p,{draftComment:n,onCommentChange:c,onSubmit:a}),(0,g.jsx)(g.Fragment,{children:0===o.length?(0,g.jsx)("p",{style:{padding:16},children:"No comments yet."}):o.map(e=>(0,g.jsx)("div",{ref:t=>{l.current[e.id]=t},onClick:()=>f(e.id),style:{position:"absolute",width:"100%",left:0,right:0,top:d[e.id]??0,zIndex:h===e.id?999:1},children:(0,g.jsx)(S,{card:e,onResolve:i},e.id)},e.id))})]})})]}):(0,g.jsx)("button",{onClick:()=>s(!0),className:`${m.toggleButton} ${m.toggleShow}`,children:"\u276e Comments"})})})}var E=n(2288);function A({children:e}){const t=(0,r.useRef)(null),[n,o]=(0,r.useState)([]),[l,m]=(0,r.useState)([]),[u,h]=(0,r.useState)(null),{selectionInfo:f,clearSelection:x}=function(){const[e,t]=(0,r.useState)(null),n=(0,r.useCallback)(()=>{const e=window.getSelection();if(!e||0===e.rangeCount||e.isCollapsed)return void t(null);const n=e.getRangeAt(0),o=n.getBoundingClientRect(),r=n.cloneContents(),s=r.querySelector?.("img"),c=n.startContainer,a=(c.nodeType,Node.TEXT_NODE,c.textContent||""),{before:i,after:l}=function(e,t,n){const o=e.slice(0,t).trim(),r=e.slice(n).trim(),s=o.split(/\s+/),c=r.split(/\s+/);return{before:s.slice(-5).join(" "),after:c.slice(0,5).join(" ")}}(a,n.startOffset,n.endOffset);if(s){const e=Array.from(document.querySelectorAll("img")).find(e=>e.src===s.src);return void(e&&t({type:"IMAGE",node:e,x:o.left+window.scrollX,y:o.top+window.scrollY,contextBefore:i,text:e.alt?.trim()||"[Image]",contextAfter:l}))}const d=e.toString().trim();t(d?{type:"TEXT",contextBefore:i,text:d,contextAfter:l,range:n.cloneRange(),x:o.left+window.scrollX,y:o.top+window.scrollY}:null)},[]);return(0,r.useEffect)(()=>(document.addEventListener("mouseup",n),()=>document.removeEventListener("mouseup",n)),[n]),{selectionInfo:e,clearSelection:()=>t(null)}}(),{user:p}=(0,s.J)(),{apiUrl:w,autoShowComments:C,repoOwner:y,repoName:j,repoID:S,repoCategoryId:b,commentPermission:$}=(0,c.T)(),[_,A]=(0,r.useState)(!1),[k,T]=(0,r.useState)(!1),[B,R]=(0,r.useState)(C);(0,r.useEffect)(()=>{const e=async e=>{const{allowed:t,error:n}=await(0,a.o)(w,y,j,p,$);if(n)console.error("Permission check failed:",n);else if(A(t),T(t),t){const{comments:t,error:n}=await async function(e,t,n,o,r,s,c){try{const a=encodeURIComponent(s),i=await fetch(`${e}/${t}/${n}/${a}/comments?category_id=${r}&repo_id=${o}&permission_level=${c}`,{credentials:"include",method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok){const e=await i.text();throw new Error(`Error ${i.status}: ${e}`)}const l=await i.json();return null==l?{comments:[]}:{comments:l}}catch(a){return console.log(a),{error:a}}}(w,y,j,S,b,window.location.pathname,$);if(n)return void console.error("Failed to load comments:",n);m(t);const r=i(t,e);o(r)}};t.current&&e(t.current)},[window.location.pathname,p,t.current]),(0,r.useEffect)(()=>{!function(e){const t=new Set(e.map(e=>e.id));document.querySelectorAll("[data-comment-id]").forEach(e=>{const n=e.getAttribute("data-comment-id");if(!n||!t.has(n)){const t=e.parentNode;if(t){for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}}}),e.forEach(e=>{if(document.querySelector(`[data-comment-id="${e.id}"]`))return;const t=document.createTreeWalker(document.querySelector("main")||document.body,NodeFilter.SHOW_TEXT);let n=null,o=1/0;for(;t.nextNode();){const r=t.currentNode,s=(r.nodeValue??"").indexOf(e.text);if(-1!==s&&r.parentElement){const t=document.createRange();t.setStart(r,s),t.setEnd(r,s+e.text.length);const c=t.getBoundingClientRect().top+window.scrollY,a=Math.abs(c-e.y);a<o&&(o=a,n=r)}}if(n){const t=n.nodeValue.indexOf(e.text),o=document.createRange();o.setStart(n,t),o.setEnd(n,t+e.text.length);const r=document.createElement("span");r.setAttribute("data-comment-id",e.id),r.className=d.highlightedText,o.surroundContents(r)}})}(n)},[n,t.current]);const I=(0,r.useCallback)(async e=>{const{id:t,error:n}=await async function(e,t,n,o,r,s,c){try{const a=encodeURIComponent(s),i=await fetch(`${e}/${t}/${n}/${a}/comments?category_id=${r}&repo_id=${o}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),l=await i.json();if(console.log(l),!i.ok){const e=await i.text();throw new Error(`Error ${i.status}: ${e}`)}return{id:l}}catch(a){return console.log("Create Comment: "+a),{error:a instanceof Error?a.message:String(a)}}}(w,y,j,S,b,window.location.pathname,e);if(!t||n)return console.error("error creating comment: ",n),h(null),void x();if(!e.comment.trim())return;const r={id:t,...e,type:"TEXT"};o(e=>[...e,r]),h(null),x()},[x]),M=(0,r.useCallback)(()=>{if(!f)return;B||R(!0);const e={id:crypto.randomUUID(),page:window.location.pathname,y:f.y,comment:"",contextBefore:f.contextBefore,text:f.text,contextAfter:f.contextAfter,top:f.y-270,resolved:!1,user:p.name,createdAt:Date.now().toString()};h(e)},[f]),O=(0,r.useCallback)(e=>{R(e),e&&(o([]),setTimeout(()=>{o(i(l,t.current))},25))},[l,t]);return(0,g.jsxs)("div",{style:{display:"flex",alignItems:"stretch"},children:[(0,g.jsxs)("div",{style:{flex:1},ref:t,children:[(0,g.jsx)(g.Fragment,{children:_&&(0,g.jsx)(g.Fragment,{children:f&&(0,v.createPortal)((0,g.jsx)("button",{onClick:M,className:d.portal,style:{top:f.y-40,left:f.x},children:"Add Comment"}),document.body)})}),(0,g.jsx)(E.A,{children:e})]}),(0,g.jsx)("div",{className:d.commentSidebar,children:(0,g.jsx)(N,{canSeeComments:k,showSidebar:B,draftComment:u,comments:n,setShowSidebar:O,setDraftComment:h,handleAddComment:I,onResolveComment:e=>{(async()=>{const{error:t}=await async function(e,t,n,o,r,s,c){try{const a=encodeURIComponent(s),i=await fetch(`${e}/${t}/${n}/${a}/comments?category_id=${r}&repo_id=${o}`,{credentials:"include",method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:c.id})});if(!i.ok){const e=await i.text();throw new Error(`Error ${i.status}: ${e}`)}return{}}catch(a){return console.error(a),{error:a instanceof Error?a.message:String(a)}}}(w,y,j,S,b,window.location.pathname,e)})(),o(t=>t.filter(t=>t.id!==e.id))}})})]})}var k=n(8478),T=n(4164),B=n(1107),R=n(7559);function I({children:e}){const t=function(){const{metadata:e,frontMatter:t,contentTitle:n}=(0,o.u)();return t.hide_title||void 0!==n?null:e.title}();return(0,g.jsxs)("div",{className:(0,T.A)(R.G.docs.docMarkdown,"markdown"),children:[t&&(0,g.jsx)("header",{children:(0,g.jsx)(B.A,{as:"h1",children:t})}),(0,g.jsx)(k.A,{fallback:(0,g.jsx)(E.A,{children:e}),children:()=>(0,g.jsx)(A,{children:e})}),(0,g.jsx)("div",{id:"modal-root"})]})}}}]);