"use strict";(self.webpackChunkmy_site=self.webpackChunkmy_site||[]).push([[8401],{7277:(e,t,n)=>{n.d(t,{A:()=>W});var o=n(542),r=n(6540);var s=n(2498),a=n(3161);function c(){const[e,t]=(0,r.useState)(!1);return(0,r.useEffect)(()=>{const e=window.matchMedia("(max-width: 996px)"),n=()=>t(e.matches);return n(),e.addEventListener("change",n),()=>e.removeEventListener("change",n)},[]),e}var i=n(6065);async function l(e,t,n,o,r,s,a){try{const c=encodeURIComponent(s),i=await fetch(`${e}/${t}/${n}/${c}/comments?category_id=${r}&repo_id=${o}`,{credentials:"include",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),l=await i.json();if(console.log(l),!i.ok){const e=await i.text();throw new Error(`Error ${i.status}: ${e}`)}return{id:l}}catch(c){return console.log("Create Comment: "+c),{error:c instanceof Error?c.message:String(c)}}}async function d(e,t,n,o,r,s,a){try{const c=encodeURIComponent(s),i=await fetch(`${e}/${t}/${n}/${c}/comments?category_id=${r}&repo_id=${o}`,{credentials:"include",method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:a.id})});if(!i.ok){const e=await i.text();throw new Error(`Error ${i.status}: ${e}`)}return{}}catch(c){return console.error(c),{error:c instanceof Error?c.message:String(c)}}}function m(e,t){return e.map(e=>{if(!e.text)return e;const n=function(e,t){const{contextBefore:n,text:o,contextAfter:r}=e,s=n?.trim()||"",a=o?.trim()||"",c=r?.trim()||"";if(!a)return null;const i=function(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let o;for(;o=n.nextNode();)o.textContent&&o.textContent.trim().length>0&&t.push(o);return t}(t),l=[{full:`${s} ${a} ${c}`.trim(),match:a},{full:`${s} ${a}`.trim(),match:a},{full:`${a} ${c}`.trim(),match:a},{full:a,match:a}];for(const d of i){if(d.parentElement?.closest("#comment-sidebar"))continue;const e=d.textContent||"";for(const{full:t,match:n}of l){let o=0;for(;;){const r=e.indexOf(t,o);if(-1===r)break;const a=r+t.indexOf(n),i=a+n.length;try{const e=document.createRange();e.setStart(d,a),e.setEnd(d,i);const t=e.getBoundingClientRect();if(u(d,s,c))return t.top+window.scrollY}catch{}o=r+t.length}}}return null}(e,t);return n?{...e,y:n}:e})}function u(e,t,n){const o=e.parentElement?.textContent||"",r=!t||o.includes(t.slice(-10)),s=!n||o.includes(n.slice(0,10));return r&&s}const h={commentLayer:"commentLayer_Vry1",commentSidebar:"commentSidebar_Hu3x",portal:"portal_mP3Z",highlightedText:"highlightedText_nRlz",hovered:"hovered_GV92",highlightedImage:"highlightedImage_l1cf",mobileCommentButton:"mobileCommentButton_Gix6",drawerOverlay:"drawerOverlay_q78T",drawer:"drawer_p9Xc",drawerHandle:"drawerHandle_jUCD",drawerHeader:"drawerHeader_YE1h",drawerBody:"drawerBody_dQXW",drawerButton:"drawerButton_K1Qm"};const f={wrapper:"wrapper_q4AH",sidebar:"sidebar_s1MZ",commentLayer:"commentLayer_yPvp",toggleButton:"toggleButton_SiYq",toggleHide:"toggleHide_uOqL",toggleShow:"toggleShow_xowA"},x="draftCommentCard_ywwp",p="draftCommentCardDesktop_eeYj",g="commentCardInput_xwF1",C="draftActions_sH1F",w="draftCommentCardButton_CvAD";var y=n(4848);const j=({draftComment:e,onCommentChange:t,onSubmit:n})=>{const o=c();return(0,y.jsxs)("div",{className:o?x:p,style:{top:`${e.top}px`},children:[(0,y.jsx)("p",{children:(0,y.jsxs)("strong",{children:["Draft for \u201c",e.text,"\u201d"]})}),(0,y.jsxs)("form",{children:[(0,y.jsx)("textarea",{placeholder:"Write your comment...",value:e.comment,className:g,onChange:e=>{t(t=>t&&{...t,comment:e.target.value})}}),(0,y.jsxs)("div",{className:C,children:[(0,y.jsx)("button",{type:"submit",className:w,onClick:t=>{e.comment.trim()&&(t.preventDefault(),n(e))},children:"Submit"}),(0,y.jsx)("button",{className:w,onClick:()=>t(null),children:"Cancel"})]})]})]})},v={commentCard:"commentCard_lLa2",quotedText:"quotedText_SCwM",commentCardDesktop:"commentCardDesktop_m4Jj",header:"header_fQQ6",preview:"preview_YR5A",footer:"footer__n3v",meta:"meta_mA2v",commentCardInput:"commentCardInput_Sl_e",showMoreButton:"showMoreButton_oENQ",resolveButton:"resolveButton_Ebqi"};var b=n(7716),S=n(3092),_=n(2239),$=n(961);const N=({card:e,onResolve:t})=>{const[n,o]=(0,r.useState)(!1),s=e.text.slice(0,50),a=e.comment.slice(0,100),i=e.text.length>50,l=e.comment.length>100,d=c();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)("div",{className:`${d?v.commentCard:v.commentCardDesktop} ${l?v.fade:""}`,onMouseEnter:()=>document.querySelector(`[data-comment-id="${e.id}"]`)?.classList.add(h.hovered),onMouseLeave:()=>document.querySelector(`[data-comment-id="${e.id}"]`)?.classList.remove(h.hovered),children:[(0,y.jsx)("div",{className:v.header,children:(0,y.jsxs)("strong",{className:v.quotedText,children:["\u201c",s,i&&"\u2026","\u201d"]})}),(0,y.jsxs)("div",{className:v.preview,children:[a,l&&"\u2026"]}),l&&(0,y.jsx)("button",{className:v.showMoreButton,onClick:e=>{e.stopPropagation(),o(!0)},children:"Show more \u2192"}),(0,y.jsxs)("div",{className:v.footer,children:[(0,y.jsxs)("div",{className:v.meta,children:[(0,y.jsxs)("span",{className:v.author,children:["- ",e.user]}),(0,y.jsx)("span",{className:v.time,children:k(e.createdAt)})]}),(0,y.jsx)("button",{className:v.resolveButton,onClick:n=>{n.stopPropagation(),t(e)},children:"Resolve"})]})]}),(0,y.jsx)(E,{open:n,onClose:()=>o(!1),card:e})]})},E=({open:e,onClose:t,card:n})=>{const o=(0,r.useRef)(null);return e?(0,$.createPortal)((0,y.jsx)("div",{ref:o,onClick:e=>e.target===o.current&&t(),style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.45)",zIndex:1005,display:"flex",alignItems:"center",justifyContent:"center",padding:"16px"},children:(0,y.jsxs)("div",{style:{background:"var(--ifm-background-surface-color)",width:"100%",maxWidth:"720px",maxHeight:"85vh",display:"flex",flexDirection:"column",borderRadius:"14px",boxShadow:"0 10px 40px rgba(0,0,0,0.25)"},onClick:e=>e.stopPropagation(),children:[(0,y.jsxs)("header",{style:{padding:"16px 20px",borderBottom:"1px solid var(--ifm-blockquote-border-color)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,y.jsxs)("h3",{style:{margin:0},children:['"',n.text,'"']}),(0,y.jsx)("button",{onClick:t,"aria-label":"Close",style:{background:"transparent",border:"none",fontSize:"20px",cursor:"pointer"},children:"\u2715"})]}),(0,y.jsx)("div",{style:{padding:"20px",overflowY:"auto",flex:1},children:(0,y.jsx)(b.oz,{remarkPlugins:[S.A],rehypePlugins:[_.A],children:n.comment})}),(0,y.jsxs)("footer",{style:{padding:"12px 20px",borderTop:"1px solid var(--ifm-blockquote-border-color)",fontSize:"14px",color:"#555",display:"flex",justifyContent:"space-between"},children:[(0,y.jsxs)("span",{children:["\u2014 ",n.user]}),(0,y.jsx)("span",{children:k(n.createdAt)})]})]})}),document.body):null};function k(e){const t=new Date(e),n=(Date.now()-t.getTime())/1e3;return n<60?`${Math.floor(n)}s ago`:n<3600?`${Math.floor(n/60)}m ago`:n<86400?`${Math.floor(n/3600)}h ago`:n<604800?`${Math.floor(n/86400)}d ago`:n<2629800?`${Math.floor(n/604800)}w ago`:n<31557600?`${Math.floor(n/2629800)}mo ago`:`${Math.floor(n/31557600)}y ago`}const A=20;function T({canSeeComments:e,showSidebar:t,draftComment:n,comments:o,setShowSidebar:s,setDraftComment:a,handleAddComment:c,onResolveComment:i}){const l=(0,r.useRef)({}),[d,m]=(0,r.useState)({}),[u,h]=(0,r.useState)(null);return(0,r.useLayoutEffect)(()=>{requestAnimationFrame(()=>{const e=o.map(e=>({id:e.id,height:l.current[e.id]?.offsetHeight??350})),t=[...o].sort((e,t)=>e.y-t.y);let n=0;const r={};for(const o of t){const t=e.find(e=>e.id===o.id)?.height??150,s=o.y-270,a=Math.max(s,n);r[o.id]=a,n=a+t+A}m(r)})},[o]),(0,y.jsx)(y.Fragment,{children:e&&(0,y.jsx)("div",{className:f.wrapper,children:t?(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)("button",{onClick:()=>s(!1),className:`${f.toggleButton} ${f.toggleHide}`,children:"\u276f"}),(0,y.jsx)("div",{className:f.sidebar,id:"comment-sidebar",children:(0,y.jsxs)("div",{className:f.commentLayer,children:[n&&(0,y.jsx)(j,{draftComment:n,onCommentChange:a,onSubmit:c}),(0,y.jsx)(y.Fragment,{children:0===o.length?(0,y.jsx)("p",{style:{padding:16},children:"No comments yet."}):o.map(e=>(0,y.jsx)("div",{ref:t=>{l.current[e.id]=t},onClick:()=>h(e.id),style:{position:"absolute",width:"100%",left:0,right:0,top:d[e.id]??0,zIndex:u===e.id?999:1},children:(0,y.jsx)(N,{card:e,onResolve:i},e.id)},e.id))})]})})]}):(0,y.jsx)("button",{onClick:()=>s(!0),className:`${f.toggleButton} ${f.toggleShow}`,children:"\u276e Comments"})})})}var B=n(2288);const I=(0,r.createContext)(null);function R(){const e=(0,r.useContext)(I);if(!e)throw new Error("useComments must be used inside <CommentsController>");return e}var D=n(9879);function O({children:e}){const t=c();return(0,y.jsx)(P,{children:t?(0,y.jsx)(q,{children:e}):(0,y.jsx)(M,{children:e})})}function M({children:e}){const{comments:t,draftComment:n,setDraftComment:o,setComments:s,clearSelection:c}=R(),[i,m]=(0,r.useState)(!0),{apiUrl:u,autoShowComments:f,repoOwner:x,repoName:p,repoID:g,repoCategoryId:C,commentPermission:w}=(0,a.T)(),j=(0,r.useCallback)(async e=>{const{id:t,error:n}=await l(u,x,p,g,C,window.location.pathname,e);if(!t||n)return console.error("error creating comment: ",n),o(null),void c();if(!e.comment.trim())return;const r={id:t,...e,type:"TEXT"};s(e=>[...e,r]),o(null),c()},[c]);return(0,y.jsxs)("div",{style:{display:"flex",alignItems:"stretch"},children:[(0,y.jsx)(H,{children:e}),(0,y.jsx)("div",{className:h.commentSidebar,children:(0,y.jsx)(T,{comments:t,canSeeComments:!0,showSidebar:i,setShowSidebar:m,draftComment:n,setDraftComment:o,handleAddComment:j,onResolveComment:e=>{(async()=>{const{error:t}=await d(u,x,p,g,C,window.location.pathname,e)})(),s(t=>t.filter(t=>t.id!==e.id))}})})]})}function q({children:e}){const{open:t,setOpen:n}=R();return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(H,{children:e}),(0,y.jsx)("button",{className:h.mobileCommentButton,onClick:()=>n(!0),children:"\ud83d\udcac"}),(0,y.jsx)(L,{open:t,onClose:()=>n(!1),children:(0,y.jsx)(F,{})})]})}function H({children:e}){const[t,n]=(0,r.useState)(!1),{contentRef:o,canComment:a,setDraftComment:c,selectionInfo:i,setOpen:l}=R(),{user:d}=(0,s.J)();return(0,r.useEffect)(()=>{n(!0)},[]),(0,r.useEffect)(()=>{i&&console.log(i)},[i]),t?(0,y.jsxs)("div",{ref:o,className:h.content,children:[a&&i&&(0,$.createPortal)((0,y.jsx)("button",{className:h.portal,style:{position:"fixed",top:i.y-window.scrollY-40,left:i.x-window.scrollX,zIndex:1e3},onMouseDown:e=>e.preventDefault(),onClick:()=>{if(!i)return;const e={id:crypto.randomUUID(),page:window.location.pathname,y:i.y,comment:"",contextBefore:i.contextBefore,text:i.text,contextAfter:i.contextAfter,top:i.y-270,resolved:!1,user:d.name,createdAt:Date.now().toString()};l(!0),c(e)},children:"Add comment"}),document.body),(0,y.jsx)(B.A,{children:e})]}):(0,y.jsx)(B.A,{children:e})}function P({children:e}){const t=(0,r.useRef)(null),[n,o]=(0,r.useState)([]),[c,l]=(0,r.useState)([]),[d,u]=(0,r.useState)(null),{selectionInfo:f,clearSelection:x}=function(){const[e,t]=(0,r.useState)(null),n=(0,r.useCallback)(()=>{const e=window.getSelection();if(!e||0===e.rangeCount||e.isCollapsed)return void t(null);const n=e.getRangeAt(0),o=n.getBoundingClientRect(),r=n.cloneContents(),s=r.querySelector?.("img"),a=n.startContainer,c=(a.nodeType,Node.TEXT_NODE,a.textContent||""),{before:i,after:l}=function(e,t,n){const o=e.slice(0,t).trim(),r=e.slice(n).trim(),s=o.split(/\s+/),a=r.split(/\s+/);return{before:s.slice(-5).join(" "),after:a.slice(0,5).join(" ")}}(c,n.startOffset,n.endOffset);if(s){const e=Array.from(document.querySelectorAll("img")).find(e=>e.src===s.src);return void(e&&t({type:"IMAGE",node:e,x:o.left+window.scrollX,y:o.top+window.scrollY,contextBefore:i,text:e.alt?.trim()||"[Image]",contextAfter:l}))}const d=e.toString().trim();t(d?{type:"TEXT",contextBefore:i,text:d,contextAfter:l,range:n.cloneRange(),x:o.left+window.scrollX,y:o.top+window.scrollY}:null)},[]);return(0,r.useEffect)(()=>(document.addEventListener("mouseup",n),()=>document.removeEventListener("mouseup",n)),[n]),{selectionInfo:e,clearSelection:()=>t(null)}}(),{user:p}=(0,s.J)(),{apiUrl:g,autoShowComments:C,repoOwner:w,repoName:j,repoID:v,repoCategoryId:b,commentPermission:S}=(0,a.T)(),[_,$]=(0,r.useState)(!1),[N,E]=(0,r.useState)(!1),[k,A]=(0,r.useState)(C);(0,r.useEffect)(()=>{(async()=>{const{allowed:e}=await(0,i.o)(g,w,j,p,S);if($(e),E(e),!e)return;const{comments:n}=await async function(e,t,n,o,r,s,a){try{const c=encodeURIComponent(s),i=await fetch(`${e}/${t}/${n}/${c}/comments?category_id=${r}&repo_id=${o}&permission_level=${a}`,{credentials:"include",method:"GET",headers:{"Content-Type":"application/json"}});if(!i.ok){const e=await i.text();throw new Error(`Error ${i.status}: ${e}`)}const l=await i.json();return null==l?{comments:[]}:{comments:l}}catch(c){return console.log(c),{error:c}}}(g,w,j,v,b,window.location.pathname,S);l(n),o(m(n,t.current))})()},[p]),(0,r.useEffect)(()=>{!function(e){const t=new Set(e.map(e=>e.id));document.querySelectorAll("[data-comment-id]").forEach(e=>{const n=e.getAttribute("data-comment-id");if(!n||!t.has(n)){const t=e.parentNode;if(t){for(;e.firstChild;)t.insertBefore(e.firstChild,e);t.removeChild(e)}}}),e.forEach(e=>{if(document.querySelector(`[data-comment-id="${e.id}"]`))return;const t=document.createTreeWalker(document.querySelector("main")||document.body,NodeFilter.SHOW_TEXT);let n=null,o=1/0;for(;t.nextNode();){const r=t.currentNode,s=(r.nodeValue??"").indexOf(e.text);if(-1!==s&&r.parentElement){const t=document.createRange();t.setStart(r,s),t.setEnd(r,s+e.text.length);const a=t.getBoundingClientRect().top+window.scrollY,c=Math.abs(a-e.y);c<o&&(o=c,n=r)}}if(n){const t=n.nodeValue.indexOf(e.text),o=document.createRange();o.setStart(n,t),o.setEnd(n,t+e.text.length);const r=document.createElement("span");r.setAttribute("data-comment-id",e.id),r.className=h.highlightedText,o.surroundContents(r)}})}(n)},[n]);const T={contentRef:t,comments:n,setComments:o,draftComment:d,setDraftComment:u,canComment:_,canSeeComments:N,open:k,setOpen:A,selectionInfo:f,clearSelection:x};return(0,y.jsx)(I.Provider,{value:T,children:e})}function L({open:e,onClose:t,children:n}){return(0,y.jsx)(D._s.Root,{open:e,onOpenChange:e=>!e&&t(),children:(0,y.jsxs)(D._s.Portal,{children:[(0,y.jsx)(D._s.Overlay,{className:h.drawerOverlay}),(0,y.jsxs)(D._s.Content,{className:h.drawer,children:[(0,y.jsx)("div",{className:h.drawerHandle}),(0,y.jsxs)("header",{className:h.drawerHeader,children:[(0,y.jsx)(D._s.Title,{children:"Comments"}),(0,y.jsx)("button",{className:h.drawerButton,onClick:t,children:"\u2715"})]}),(0,y.jsx)("div",{className:h.drawerBody,children:n})]})]})})}function F(){const{comments:e,draftComment:t,setDraftComment:n,setComments:o,clearSelection:s}=R(),{apiUrl:c,autoShowComments:i,repoOwner:m,repoName:u,repoID:h,repoCategoryId:f,commentPermission:x}=(0,a.T)(),p=(0,r.useCallback)(async e=>{const{id:t,error:r}=await l(c,m,u,h,f,window.location.pathname,e);if(!t||r)return console.error("error creating comment: ",r),n(null),void s();if(!e.comment.trim())return;const a={id:t,...e,type:"TEXT"};o(e=>[...e,a]),n(null),s()},[s]);return(0,y.jsxs)(y.Fragment,{children:[t&&(0,y.jsx)(j,{draftComment:t,onCommentChange:n,onSubmit:p}),e.map(e=>(0,y.jsx)(N,{card:e,onResolve:()=>{return t=e,(async()=>{const{error:e}=await d(c,m,u,h,f,window.location.pathname,t)})(),void o(e=>e.filter(e=>e.id!==t.id));var t}},e.id))]})}var X=n(8478),Y=n(4164),U=n(1107),z=n(7559);function W({children:e}){const t=function(){const{metadata:e,frontMatter:t,contentTitle:n}=(0,o.u)();return t.hide_title||void 0!==n?null:e.title}();return(0,y.jsxs)("div",{className:(0,Y.A)(z.G.docs.docMarkdown,"markdown"),children:[t&&(0,y.jsx)("header",{children:(0,y.jsx)(U.A,{as:"h1",children:t})}),(0,y.jsx)(X.A,{fallback:(0,y.jsx)(B.A,{children:e}),children:()=>(0,y.jsx)(O,{children:e})}),(0,y.jsx)("div",{id:"modal-root"})]})}}}]);